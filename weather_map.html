<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Weather Map Project Lee</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
        <script src='https://api.mapbox.com/mapbox-gl-js/v1.9.0/mapbox-gl.js'></script>
        <link href='https://api.mapbox.com/mapbox-gl-js/v1.9.0/mapbox-gl.css' rel='stylesheet' />
        <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.2.0/mapbox-gl-geocoder.css' type='text/css' />
    </head>
    <body>
        <div id="main-heading">
            <span class="badge badge-block badge-primary mb-3" style="width: 100%;"><header><h2>Weather App</h2></header></span>
        </div>

        <div id="search-bar" class="mb-3">
            <span>
                Place:
                <input id="search-city" type="text" placeholder="City, State"><button id="submit-city">Find</button>
            </span>
        </div>

        <div id="main_content" class="row">
        </div>

        <div id='map' style='width: 100%; height: 400px;'></div>

        <!-- First use the AJAX jQuery from google CDN -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <!-- Then used my "key" from js folder which will NOT be pushed to github (.gitignore) -->
        <script src="js/keys.js"></script>
        <!-- Bootstrap CDN -->
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
        <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.2.0/mapbox-gl-geocoder.min.js'></script>
        <script src="js/mapbox-geocoder-utils.js"></script>
        <!-- Now AJAX -->
        <script>
            // todo Start by showing the current conditions for city you live in on your page
            // From https://openweathermap.org/current
            "use strict";
            (function () {
                    // For one day weather cast
                    // var currentURL = "http://api.openweathermap.org/data/2.5/weather?q=Dallas,Texas&units=imperial&appid="+OpenWeatherMap_Key;
                    //
                    // $.get(currentURL)
                    // .done(function (weatherData) {
                    //     console.log(weatherData);
                    //     console.log(weatherData.weather[0].icon);
                    //     console.log(weatherData.coord);
                    //     console.log(weatherData.weather[0].description)
                    //
                    //     var testingHTML = "";
                    //
                    //     testingHTML = "<h1>" + weatherData.weather[0].description + "</h1>"
                    //
                    //     $("#testing").append(testingHTML);
                    // }).fail(function (error) {
                    //     console.log(error);
                    // });


                // Forecast
                $.get("http://api.openweathermap.org/data/2.5/forecast", {
                    APPID: OpenWeatherMap_Key,
                    q: "Dallas, US",
                    "units": "imperial"
                }).done(function (weatherData) {
                    console.log(weatherData);
                    console.log(weatherData.list[0].main); // focus on first value
                    console.log(weatherData.list[0].dt_txt); // will give you the dates (2020-04-16 21:00:00)
                    console.log(typeof (weatherData.list[0].dt_txt)); // string
                    console.log((weatherData.list[0].dt_txt).slice(0, 10)); // will slice the timeline (2020-04-16)
                    console.log(weatherData.list[0].weather[0].icon); //weather icon
                    console.log(weatherData.list[0].main.temp_max + " Degrees F");
                    console.log(weatherData.list[0].main.temp_min + " Degrees F"); // &#8457; for fahrenheit HTML
                    console.log(weatherData.list[0].main.temp_max + " F " + " / " +weatherData.list[0].main.temp_min + " F")
                    console.log(weatherData.list[0].weather[0].description); // Description
                    console.log(weatherData.list[0].main.humidity); // humidity
                    console.log(weatherData.list[0].wind.speed); // wind speed miles per hours;
                    console.log(weatherData.list[0].main.pressure); // hPa (hecto Pascal)


                        // var imgUrl = "http://openweathermap.org/img/w/"+weather[0].icon+".png";
                        // $(".card-img").attr('src', imgUrl);

                        // var newDate = "";
                        // var newTemp = "";
                        // var newIcon = "http://openweathermap.org/img/w/" + weatherData.list[0].weather[0].icon + ".png";
                        // $(".weather-icon").attr('src', newIcon);
                        // var newDes = "";
                        // var newHum = "";
                        // var newWind = "";
                        // var newPres  = "";

                        // newDate = ((weatherData.list[0].dt_txt).slice(0, 10));
                        // $(".date").append(newDate);

                        // newTemp = ("<strong>" +weatherData.list[0].main.temp_max + " ºF " + "</strong>" + " / " + "<strong>" + weatherData.list[0].main.temp_min + " ºF" + "</strong>");
                        // $(".temp").append(newTemp);

                        // newDes = ("Desciption: " + "<strong>" + weatherData.list[0].weather[0].description + "</strong>");
                        // $(".des").append(newDes)
                        //
                        // newHum = ("Humidity: " + "<strong>" + weatherData.list[0].main.humidity + " %" + "</strong>");
                        // $(".humid").append(newHum);
                        //
                        // newWind = ("Wind: " + "<strong>" + weatherData.list[0].wind.speed + " mph" + "</strong>");
                        // $(".wind").append(newWind);
                        //
                        // newPres = ("Pressure: " + "<strong>" + weatherData.list[0].main.pressure + " hPa" + "</strong>");
                        // $(".press").append(newPres);
                    var htmlBody = "";

                    // todo Tried to connect the button function work.
                    // var button = $('#submit-city');
                    // button.click(weatherDataAsked);
                    // function weatherDataAsked() {
                    //     var url = "http://api.openweathermap.org/data/2.5/weather?q="+ input.value() +"&units=imperial&appid="+OpenWeatherMap_Key;
                    //     loadJSON(url, gotData);
                    // }

                    for (var x = 0; x < 40; x += 8) {
                        var imgUrl = "http://openweathermap.org/img/w/" + weatherData.list[x].weather[0].icon+".png";
                        $("#icon").attr('src', imgUrl);                     // style='height: 40vh;'
                        htmlBody += "<div class='card col mb-3 mx-auto'>"+
                                    "<ul class=\"list-group list-group-flush\">"+
                                    "<li class=\"list-group-item text-center bg-light\">"+ (weatherData.list[x].dt_txt).slice(0, 10) +"</li>"+
                                    "<li class=\"list-group-item text-center\">"+ "<strong>" +weatherData.list[x].main.temp_max + " ºF " + "</strong>" + " / " + "<strong>" + weatherData.list[x].main.temp_min + " ºF" + "</strong>"+"</li>"+
                                    "<li class=\"list-group-item text-center\">"+"<img src='http://openweathermap.org/img/wn/" + weatherData.list[x].weather[0].icon + "@2x.png'" +"</li>"+
                                    "<li class=\"list-group-item\">"+ "Desciption: "+ "<strong>" + weatherData.list[x].weather[0].description + "</strong>" +"</li>"+
                                    "<li class=\"list-group-item\">"+ "Humidity: " + "<strong>" + weatherData.list[x].main.humidity + " %" + "</strong>" +"</li>"+
                                    "<li class=\"list-group-item\">"+ "Wind: " + "<strong>" + weatherData.list[x].wind.speed + " mph" + "</strong>"+ "</li>"+
                                    "<li class=\"list-group-item\">"+ "Pressure: " + "<strong>" + weatherData.list[x].main.pressure + " hPa" + "</strong>"+"</li>"+
                                    "<li class=\"list-group-item\">"+ "<strong>" + weatherData.list[x].weather[0].description + "</strong>" +"</li>"+
                                    "</ul>"+
                                    "</div>";
                    }
                    $("#main_content").append(htmlBody);





                }).fail(function (error) {
                    console.log(error);
                });
            }) ();
        </script>
        <script>
            mapboxgl.accessToken = mapboxToken;
            var map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/streets-v9',
                zoom: 12,
                center: [-96.798685, 32.781214]
            });

            // Yes we can set the zoom "programmatically".
            // map.setZoom(15);

            var restaurantArray = [
                {
                    address: "4350 Belt Line Rd, Addison, TX 75001",
                    popupHTML: "<p>Osaka Sushi Grill<br>4350 Belt Line Rd, Addison, TX 75001</p>"
                },
                {
                    address: "8580 TX-121, Frisco, TX 75034",
                    popupHTML: "<p>Buca di Beppo Italian Restaurant<br>8580 TX-121, Frisco, TX 75034</p>"
                },
                {
                    address: "1520 Elm St #111, Dallas, TX 75201",
                    popupHTML: "<p>Campisi's Restaurants | Downtown Dallas<br>1520 Elm St #111, Dallas, TX 75201</p>"
                },
                {
                    address: "944 E Copeland Rd, Arlington, TX 76011",
                    popupHTML: "<p>Asian Buffet<br>944 E Copeland Rd, Arlington, TX 76011</p>"
                },
                {
                    address: "3726 Towne Crossing Blvd, Mesquite, TX 75150",
                    popupHTML: "<p>Snuffer's<div class='best'>Home of the best Cheese Fries</div>3726 Towne Crossing Blvd, Mesquite, TX 75150</p>"
                }
            ];

            restaurantArray.forEach(function(restaurant) {
                console.log('Douglas\'s favorite restaurants: ', restaurant);
                geocode(restaurant.address, mapboxToken).then(function(coordinates){
                    //    creat marker here
                    var marker = new mapboxgl.Marker()
                        .setLngLat(coordinates)
                        .addTo(map);
                    //    popup with the name of the restaurant
                    var popup = new mapboxgl.Popup()
                        .setHTML(restaurant.popupHTML)
                    // Make sure the info window does not display until the marker has been clicked on.
                    // in order to 'click' to pop up, disable .addTo(map) one
                    // .addTo(map);
                    marker.setPopup(popup);
                });
            });
        </script>
    </body>
</html>